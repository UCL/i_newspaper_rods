---
title: Gendered words over time in the Times Data Archive
---


We can start by loading the libraries we will be using for data analysis. 

```{r loadLibraries}
suppressPackageStartupMessages(library(yaml))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(MASS))
suppressPackageStartupMessages(library(data.table))
suppressPackageStartupMessages(library(magrittr))
suppressPackageStartupMessages(library(pander))
suppressPackageStartupMessages(library(car))
suppressPackageStartupMessages(library(tidyverse))
```


Now we need to load in our data file and change the structure from YAML
to something that we can more easily manipulate.

```{r loadData}
data = yaml.load_file("words_over_time.yml")
counts = lapply(names(data), function(year){
  lapply(data[[year]], function(pair) {
    data.frame(year=as.numeric(year), word=pair[[1]], count=as.numeric(pair[[2]]))
  }) %>% rbindlist
}) %>% rbindlist
```

We should merge the multiple spelling words. These are:

   * Househusband, house husband, house-husband
   * Housewife, house wife, house-wife

These may be the only words which contain "-" or " ", which we should check.

```{r checkForHyphenOrSpace}
counts %>% 
  ungroup %>%
  dplyr::select(word) %>% 
  unique %>%
  filter(grepl("[ -]", word)) %>% 
  as.vector() %>% 
  pander
```

These are the only words that contain "-", but "he said" and "she said" contain " ". So we should be a bit more careful and use `recode`. However, after
this we will need to recompute the counts.

```{r mergeMultiWords}
counts %<>%
  mutate(word = recode(word, "'house husband'='househusband';'house-husband'='househusband';'house wife'='housewife';'house-wife'='housewife'")) %>%
  group_by(year, word) %>%
  summarize(count = sum(count))
```
 

```{r simplePlot,fig.height=50,fig.width=10}
ggplot(counts, aes(x=year,y=count +1)) + 
  geom_point() +
  geom_line() +
  scale_y_log10() +
  facet_wrap(~word, ncol=4) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

There are a few things that I have noticed that might be interesting:

   * himself/herself/itself etc only seem to appear in the archive at the start of the 1800's
   * The length of the times archive per year / issue / article is not constant. This will hide aspects of the trend. 
   
We can start by trying to address the issue of word published per year. Fortunately, we have this data available as well.

```{r getYearWordCounts}
words_per_year = fread('words_per_year.csv', header=T)
```

And we can see there is a large difference in how many words are published year to year.

```{r showWordsIncreasingAnnually}
ggplot(words_per_year,aes(year,num_words)) +
  geom_point() + 
  geom_line()
```

We can now add this data into our table of occurances.

```{r joinCountsandTotalCounts}
combined = left_join(counts,words_per_year,by="year")
assertthat::are_equal(nrow(counts),nrow(combined))
```

This enables to us to plot how much of the total annual writing a single word makes up over time.
This normalises for the effect of the changing size of the corpus from year to year.

Since the words all appear with very differing frequencies, we will make the plots each have 
independant x axes, so we can see the trend for each word individually.

```{r normalisedWordCountPlot, fig.height=50, fig.width=10}
ggplot(combined, aes(year, 10000 * count/num_words)) +
  geom_point() + 
  geom_line() +
  xlab("Year") + 
  ylab("Per 10k of annual words") +
  facet_wrap(~word, ncol=3,scales = "free_y")
```

Actually deciding what this data all means can be a bit difficult. 
So for this analysis we want to focus on two different different aspects of representation. 

   * Referential - When different genders are mentioned in articles. Ie. An article about a man or a woman who sum the Channel. 
   * Agentive - When a agent of a given gender says something
   
We will try use mutliple measures where possible to mitigate bias and OCR errors. 


## Referential Gender Variation

We can begin to get an idea about the frequency of references to different genders by plotting the curve of the difference in 
their relative mentions. Doing this for a couple of word pairs should give us an indication of possible trends.

We can start by picking some common word pairs to consider:

   * He - She
   * Him - Her
   * Himself - Herself
   * Man - Woman
   * Boy - Girl
   * Lad - Lass
   
As well as the animal pairs: 

 * Lion - Lioness
 * Buck - Doe
 * Stallion - Mare
 * Boar - Sow
 * Ram - Ewe
 
In terms of count, rather than using the count of words relative to the total words in the archive 
for that year, we will look at the ratio of the female form to the total of male + female. 
 
```{r rReferencePairs, fig.width=10,fig.height=15}
referencePairs = c("he","she",
                    "him","her",
                    "himself","herself",
                    "man","woman",
                    "boy","girl",
                    "lad","lass",
                    "lion","lioness",
                    "buck","doe",
                    "stallion","mare",
                    "boar","sow",
                    "ram","ewe")
combined %>% 
  filter(word %in% referencePairs) %>% 
  rowwise() %>% 
  mutate(gender = ifelse(mod(which(word == referencePairs),2) == 0, "Female", "Male"),
         group  = as.integer((which(word == referencePairs) - 1) / 2),
         group_name = paste(referencePairs[(2*group) + 2], referencePairs[(2*group) + 1], sep = ' - ')) %>% 
  ungroup() %>%
  dplyr::select(year, group_name, gender, count) %>% 
  spread(gender, count) %>% 
  ggplot(aes(year,  Female / (Male + Female))) +
  geom_point() + 
  geom_line() + 
  facet_wrap(~group_name, scales="free_y",ncol=3)
```

One needs to be careful interpretting the results because the quality of the OCR is exremely variable. For short words,
like he and he, there is a higher probability of them being OCR artefacts as opposed to real words. For longer words there
may be issues around the OCR detecting the whole word. 

## Agentive Gender Variation

We can now use the same method and look for actions. In our data set this is:

   * He said - She Said
   
```{r rAgentivePairs, fig.width=10,fig.height=5}
referencePairs = c("he said","she said")
combined %>% 
  filter(word %in% referencePairs) %>% 
  rowwise() %>% 
  mutate(gender = ifelse(mod(which(word == referencePairs),2) == 0, "Female", "Male"),
         group  = as.integer((which(word == referencePairs) - 1) / 2),
         group_name = paste(referencePairs[(2*group) + 2], referencePairs[(2*group) + 1], sep = ' - ')) %>% 
  ungroup() %>%
  dplyr::select(year, group_name, gender, count) %>% 
  spread(gender, count) %>%
  ggplot(aes(year,  Female / (Male + Female))) +
  geom_point() + 
  geom_line() + 
  facet_wrap(~group_name)
```